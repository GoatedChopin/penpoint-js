<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Penpoint JavaScript Client - Browser Example</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            line-height: 1.6;
        }
        .container {
            background: #f8f9fa;
            border-radius: 8px;
            padding: 20px;
            margin: 20px 0;
        }
        .file-input {
            margin: 10px 0;
        }
        .button {
            background: #007bff;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 4px;
            cursor: pointer;
            margin: 5px;
        }
        .button:hover {
            background: #0056b3;
        }
        .button:disabled {
            background: #6c757d;
            cursor: not-allowed;
        }
        .result {
            background: white;
            border: 1px solid #dee2e6;
            border-radius: 4px;
            padding: 15px;
            margin: 10px 0;
            white-space: pre-wrap;
            font-family: monospace;
            font-size: 14px;
        }
        .error {
            background: #f8d7da;
            border-color: #f5c6cb;
            color: #721c24;
        }
        .success {
            background: #d4edda;
            border-color: #c3e6cb;
            color: #155724;
        }
        .loading {
            color: #6c757d;
            font-style: italic;
        }
    </style>
</head>
<body>
    <h1>üöÄ Penpoint JavaScript Client - Browser Example</h1>
    
    <div class="container">
        <h2>Configuration</h2>
        <label for="apiKey">API Key:</label><br>
        <input type="password" id="apiKey" placeholder="Enter your Penpoint API key" style="width: 100%; padding: 8px; margin: 5px 0;">
        <br>
        <button class="button" onclick="testConnection()">Test Connection</button>
    </div>

    <div class="container">
        <h2>File Operations</h2>
        <div class="file-input">
            <label for="fileInput">Select a file to upload:</label><br>
            <input type="file" id="fileInput" accept=".pdf,.doc,.docx,.txt">
        </div>
        <button class="button" onclick="uploadFile()">Upload File</button>
        <button class="button" onclick="listFiles()">List Files</button>
        <div id="fileResult" class="result" style="display: none;"></div>
    </div>

    <div class="container">
        <h2>Reference Search</h2>
        <label for="fileId">File ID:</label><br>
        <input type="number" id="fileId" placeholder="Enter file ID" style="width: 100px; padding: 8px; margin: 5px 0;">
        <br>
        <label for="searchPrompt">Search Prompt:</label><br>
        <input type="text" id="searchPrompt" placeholder="Enter search term" style="width: 100%; padding: 8px; margin: 5px 0;">
        <br>
        <button class="button" onclick="searchBasic()">Basic Search</button>
        <button class="button" onclick="searchStandard()">Standard Search</button>
        <button class="button" onclick="searchAdvanced()">Advanced Search</button>
        <div id="searchResult" class="result" style="display: none;"></div>
    </div>

    <script type="module">
        // Import the Penpoint client
        import { PenpointClient } from '../src/index.js';

        let client = null;

        // Test connection function
        window.testConnection = async function() {
            const apiKey = document.getElementById('apiKey').value;
            if (!apiKey) {
                showResult('fileResult', 'Please enter an API key', 'error');
                return;
            }

            try {
                client = new PenpointClient({ apiKey });
                showResult('fileResult', '‚úÖ Connection successful! Client initialized.', 'success');
            } catch (error) {
                showResult('fileResult', `‚ùå Connection failed: ${error.message}`, 'error');
            }
        };

        // Upload file function
        window.uploadFile = async function() {
            if (!client) {
                showResult('fileResult', 'Please test connection first', 'error');
                return;
            }

            const fileInput = document.getElementById('fileInput');
            const file = fileInput.files[0];
            
            if (!file) {
                showResult('fileResult', 'Please select a file first', 'error');
                return;
            }

            try {
                showResult('fileResult', 'üì§ Uploading file...', 'loading');
                
                const uploadedFile = await client.files.upload({
                    file: file,
                    filename: file.name,
                    summary: 'Uploaded via browser example'
                });

                showResult('fileResult', 
                    `‚úÖ File uploaded successfully!\n` +
                    `ID: ${uploadedFile.id}\n` +
                    `Name: ${uploadedFile.name}\n` +
                    `Pages: ${uploadedFile.pages || 'N/A'}\n` +
                    `Created: ${uploadedFile.created_at}`, 
                    'success'
                );
            } catch (error) {
                showResult('fileResult', `‚ùå Upload failed: ${error.message}`, 'error');
            }
        };

        // List files function
        window.listFiles = async function() {
            if (!client) {
                showResult('fileResult', 'Please test connection first', 'error');
                return;
            }

            try {
                showResult('fileResult', 'üìÅ Loading files...', 'loading');
                
                const files = await client.files.list({ limit: 10 });
                
                if (files.data.length === 0) {
                    showResult('fileResult', 'No files found', 'success');
                    return;
                }

                let result = `üìÅ Found ${files.data.length} files:\n\n`;
                files.data.forEach(file => {
                    result += `ID: ${file.id}\n`;
                    result += `Name: ${file.name}\n`;
                    result += `Summary: ${file.summary || 'No summary'}\n`;
                    result += `Created: ${file.created_at}\n`;
                    result += `---\n`;
                });

                showResult('fileResult', result, 'success');
            } catch (error) {
                showResult('fileResult', `‚ùå Failed to list files: ${error.message}`, 'error');
            }
        };

        // Search functions
        window.searchBasic = () => performSearch('basic');
        window.searchStandard = () => performSearch('standard');
        window.searchAdvanced = () => performSearch('advanced');

        async function performSearch(searchType) {
            if (!client) {
                showResult('searchResult', 'Please test connection first', 'error');
                return;
            }

            const fileId = document.getElementById('fileId').value;
            const prompt = document.getElementById('searchPrompt').value;

            if (!fileId || !prompt) {
                showResult('searchResult', 'Please enter both file ID and search prompt', 'error');
                return;
            }

            try {
                showResult('searchResult', `üîç Performing ${searchType} search...`, 'loading');

                let result;
                switch (searchType) {
                    case 'basic':
                        result = await client.discreteReferences.basic(parseInt(fileId), prompt, false);
                        break;
                    case 'standard':
                        result = await client.discreteReferences.standard(parseInt(fileId), prompt, false);
                        break;
                    case 'advanced':
                        result = await client.discreteReferences.advanced(parseInt(fileId), prompt, false);
                        break;
                }

                if (result.refs.parts.length === 0) {
                    showResult('searchResult', `No references found for "${prompt}"`, 'success');
                    return;
                }

                let resultText = `üîç ${searchType.charAt(0).toUpperCase() + searchType.slice(1)} search results for "${prompt}":\n\n`;
                result.refs.parts.slice(0, 5).forEach((part, index) => {
                    resultText += `Result ${index + 1}:\n`;
                    resultText += `Segment: ${part.segment.substring(0, 200)}...\n`;
                    resultText += `Score: ${part.hybrid_score.toFixed(3)}\n`;
                    resultText += `Page: ${part.page_number}\n`;
                    resultText += `---\n`;
                });

                if (result.refs.parts.length > 5) {
                    resultText += `... and ${result.refs.parts.length - 5} more results`;
                }

                showResult('searchResult', resultText, 'success');
            } catch (error) {
                showResult('searchResult', `‚ùå ${searchType} search failed: ${error.message}`, 'error');
            }
        }

        // Helper function to show results
        function showResult(elementId, message, type) {
            const element = document.getElementById(elementId);
            element.textContent = message;
            element.className = `result ${type}`;
            element.style.display = 'block';
        }
    </script>
</body>
</html>
